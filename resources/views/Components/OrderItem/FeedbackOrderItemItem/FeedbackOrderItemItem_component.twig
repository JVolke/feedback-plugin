<script type="text/javascript">
    (function($) {
        Vue.component('feedback-orderitem-item', {

            template: '#vue-feedback-orderitem-item',
            delimiters: ["${", "}"],
            props: ['item', 'options', 'classes', 'styles'],

            data: function()
            {
                return {
                    isRated: false,
                    ratingValue: 0
                };
            },

            mounted: function() {
                var _self = this;
                vueEventHub.$on('orderItemFeedbackAdded', function(event) {
                    if(event.variationId === _self.item.variationId) {
                        _self.ratingValue = event.ratingValue;
                        _self.isRated = true;
                    }
                });
            },

            computed: {
                starIds: function() {
                    var ids = [];
                    var starClass = this.isRated ? "star-rated" : "star";

                    for(var i = 5; i > 0; i--) {
                        ids.push(
                            {
                                value: i,
                                id: "star-" + i + "-" + this.item.variationId,
                                class: starClass
                            }
                        );
                    }

                    return ids;
                }
            },

            methods: {
                handleRating: function(value) {
                    this.ratingValue = value;

                    var _self = this;
                    vueEventHub.$emit('orderItemAddFeedback', {
                        item: _self.item,
                        ratingValue: value
                    });
                }
            }
        });
    })(jQuery);
</script>
